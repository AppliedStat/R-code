#=========================================================
source("https://raw.githubusercontent.com/AppliedStat/R-code/master/2006c/Rk2.R")
library(MASS)
#=========================================================

#
# Input Data 
#  See Hoel & Walburg (1972). 
#      Statistical analysis of survival experiments
#      Nat. Cancer Inst. 49, 361 - 372.
# 
#
X01 = c(159, 189, 191, 198, 200, 207, 220, 235, 245, 250,
        256, 261, 265, 266, 280, 343, 350, 383, 403, 414,
        428, 432,

        317, 318, 399, 495, 525, 536, 549, 552, 554, 557, 
        558, 571, 586, 594, 596, 605, 612, 621, 628, 631,
        636, 643, 647, 648, 649, 661, 663, 666, 670, 695,
        697, 700, 705, 712, 713, 738, 748, 753,

         40,  42,  51,  62, 163, 179, 206, 222, 228, 252,
        259, 282, 324, 333, 341, 366, 385, 407, 420, 431,
        441, 461, 462, 482, 517, 517, 524, 564, 567, 586,
        619, 620, 621, 622, 647, 651, 686, 761, 763)

X02 = c(158, 192, 193, 194, 195, 202, 212, 215, 229, 230, 
        237, 240, 244, 247, 259, 300, 301, 321, 337, 415, 
        434, 444, 485, 496, 529, 537, 624, 707, 800,

        430, 590, 606, 638, 655, 679, 691, 693, 696, 747,
        752, 760, 778, 821, 989,

        136, 246, 255, 376, 421, 565, 616, 617, 652, 655,
        658, 660, 662, 675, 681, 734, 736, 737, 757, 769, 
        777, 800, 806, 825, 855, 857, 864, 868, 870, 870,
        873, 882, 895, 910, 934, 942,1015,1019)

# Assign causes (C1=1, C2=2, C3=3)
d01 = rep( c(1,2,3), c(22,38,39) )   
d02 = rep( c(1,2,3), c(29,15,38) )

X0  = list (X01, X02); d0  = list (d01, d02)

#----------------------------------------------------------
n1 = length(unlist(X01))
n2 = length(unlist(X02))
grand.mean = mean( unlist(X0) )
#----------------------------------------------------------

#
# Generating censoring times.
# We generated the censoring time in Table 1 as follows 
#
## set.seed(1)
## U1 = round( rexp(n1, rate=1/grand.mean ), 0)
## U2 = round( rexp(n2, rate=1/grand.mean ), 0)
## 
# If you de-comment the above three lines, you will get the following.
#    The following random numbers might be different,
#    based on R version because of different random seeds.

U1=c(2801,  55,1315, 148,2270,2973, 177, 183,  21, 383,
      199,1420,  86, 515,   2, 985, 577,1368,1019, 224,
       83, 336, 

       61, 106,1867,  63,  78, 110,   3, 751, 300,1224,
      313, 198,  13,  57, 423, 125,1315,  29, 433, 146,
     1473, 298,1300, 384, 852, 421, 201,  84, 138, 117,
      458, 979, 182,2437, 169, 820, 482, 365,

      738,1721, 873,  37,1203, 217, 930, 397, 859, 192,
      521, 475,  99, 455, 239,1117,1159, 162,  91,2006,
       38, 829, 290,   7, 101, 400, 928,   7, 156, 715,
      116, 620, 182, 465,  74, 980, 443, 821, 448)

U2=c( 479,  13, 153, 162, 135,  22,  92,  65,  79, 393,
      984,1083, 221, 631, 441, 847, 337, 321,  50, 127,
       25, 735, 215,1297, 171, 535,  21, 155, 212,

      717, 217, 792, 159, 662, 304,  12,  51, 361,  31,
      681, 994, 192, 787, 112, 

      309, 145, 403,  82, 710, 138, 286, 112,  44,1281,
      345, 277, 508, 402, 168, 207,1165, 975,  25, 165,
      873,   5, 249, 102,  52,  21,  99, 791, 126,  62,
     1325,  71, 105, 355, 392, 233, 96,1271)
#==========================================================


#==========================================================
# When rho = 0
rho = 0.0 
#----------------------------------------------------------
cat("\n======================================\n")
cat(" c = Inf ", " rho =", rho, "\n")
X0 = list (X01, X02); d0 = list (d01, d02)
KBweight.test(X0,d0,m=3, rho)


#----------------------------------------------------------
cat("\n======================================\n")
cat(" c = 0.1 ", " rho =", rho, "\n")
X1 = pmin(X01, 0.1*U1); d1 = d01*(X01 < 0.1*U1)
X2 = pmin(X02, 0.1*U2); d2 = d02*(X02 < 0.1*U2)
X  = list (X1, X2); d  = list (d1, d2)
KBweight.test(X,d,m=3, rho)  


#==========================================================
# When rho = 0.1
rho = 0.1 
#----------------------------------------------------------
cat("\n======================================\n")
cat(" c = Inf ", " rho =", rho, "\n")
X0 = list (X01, X02); d0 = list (d01, d02)
KBweight.test(X0,d0,m=3, rho)


#----------------------------------------------------------
cat("\n======================================\n")
cat(" c = 0.1 ", " rho =", rho, "\n")
X1 = pmin(X01, 0.1*U1); d1 = d01*(X01 < 0.1*U1)
X2 = pmin(X02, 0.1*U2); d2 = d02*(X02 < 0.1*U2)
X  = list (X1, X2); d  = list (d1, d2)
KBweight.test(X,d,m=3, rho)  


#==========================================================
# When rho = 1.0
rho = 1.0 
#----------------------------------------------------------
cat("\n======================================\n")
cat(" c = Inf ", " rho =", rho, "\n")
X0 = list (X01, X02); d0 = list (d01, d02)
KBweight.test(X0,d0,m=3, rho)


#----------------------------------------------------------
cat("\n======================================\n")
cat(" c = 0.1 ", " rho =", rho, "\n")
X1 = pmin(X01, 0.1*U1); d1 = d01*(X01 < 0.1*U1)
X2 = pmin(X02, 0.1*U2); d2 = d02*(X02 < 0.1*U2)
X  = list (X1, X2); d  = list (d1, d2)
KBweight.test(X,d,m=3, rho)  


